<script>
  const textarea = document.getElementById('editor');
  const status = document.getElementById('status');

  let lastSavedContent = "";

  // Load the initial content from the server
  fetch('/load')
    .then(res => res.json())
    .then(data => {
      textarea.value = data.content;
      lastSavedContent = data.content;
      status.textContent = "Loaded.";
    });

  // Real autosave: save every 2 seconds if content changed
  setInterval(() => {
    const currentContent = textarea.value;
    if (currentContent !== lastSavedContent) {
      fetch('/save', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ content: currentContent })
      })
      .then(res => res.json())
      .then(data => {
        lastSavedContent = currentContent;
        status.textContent = `Auto-saved at ${new Date().toLocaleTimeString()}`;
      });
    }
  }, 2000);  // every 2 seconds

  // Optional manual save button
  function manualSave() {
    fetch('/save', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ content: textarea.value })
    })
    .then(res => res.json())
    .then(data => {
      lastSavedContent = textarea.value;
      status.textContent = `Manually saved at ${new Date().toLocaleTimeString()}`;
    });
  }
</script>
